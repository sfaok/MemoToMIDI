# Step 3 Real Audio Comparison

## Part A - Real Audio Used
- Source audio: `/Users/jamesrobertson/Downloads/Cedarcrest Blvd 955.m4a`
- Converted WAV for test pipeline: `/Users/jamesrobertson/MemoToMIDI/MemoToMIDI/cqt_spike/step3_real_audio_input.wav`
- Duration (seconds): `13.312`
- Sample rate (Hz): `22050`
- Amplitude range: min=`-0.913982`, max=`0.893684`, rms=`0.150445`

## Inputs
- CoreML model: `/Users/jamesrobertson/MemoToMIDI/MemoToMIDI/cqt_spike/BasicPitch_from_tf.mlpackage`
- Overlap frames: `30`

## Input Parity (Same Windowed Pipeline)
- TF windows: `9`
- CoreML windows: `9`
- Global max abs diff (input tensors): `0.000000000000`
- Global mean abs diff (input tensors): `0.000000000000`
- Verdict: `IDENTICAL (<1e-6)`

## Part B.1 - TF Note Activation Histogram (Full Pipeline)
- Histogram bins: `[0.0, 0.1), ..., [0.9, 1.0]`
| Bin | Count |
| --- | ---: |
| 0.0-0.1 | 37569 |
| 0.1-0.2 | 58612 |
| 0.2-0.3 | 1690 |
| 0.3-0.4 | 738 |
| 0.4-0.5 | 654 |
| 0.5-0.6 | 780 |
| 0.6-0.7 | 881 |
| 0.7-0.8 | 443 |
| 0.8-0.9 | 9 |
| 0.9-1.0 | 0 |

- Total activations: `101376`
- Peak activation value: `0.809264`
- Activations above 0.7: `452`
- Activations above 0.8: `9`

## Part B.2 - Single Window (No Stitching, `note` head)
- Max abs diff: `0.105468959`
- Mean abs diff: `0.001717866`
- Frame-flip rates (% of active TF frames):
- threshold `0.3`: active_frames_tf=`28`, flipped_active_frames=`9`, frame_flip_rate_pct=`32.142857`
- threshold `0.4`: active_frames_tf=`26`, flipped_active_frames=`8`, frame_flip_rate_pct=`30.769231`
- threshold `0.5`: active_frames_tf=`23`, flipped_active_frames=`6`, frame_flip_rate_pct=`26.086957`
- threshold `0.6`: active_frames_tf=`19`, flipped_active_frames=`3`, frame_flip_rate_pct=`15.789474`

## Part B.3 - Full Pipeline (With Stitching, `note` head)
- Max abs diff: `0.118194401`
- Mean abs diff: `0.004222867`
- Frame-flip rates (% of active TF frames):
- threshold `0.3`: active_frames_tf=`1012`, flipped_active_frames=`252`, frame_flip_rate_pct=`24.901186`
- threshold `0.4`: active_frames_tf=`976`, flipped_active_frames=`204`, frame_flip_rate_pct=`20.901639`
- threshold `0.5`: active_frames_tf=`892`, flipped_active_frames=`192`, frame_flip_rate_pct=`21.524664`
- threshold `0.6`: active_frames_tf=`699`, flipped_active_frames=`217`, frame_flip_rate_pct=`31.044349`

## Part B.4 - Musical Validation (Basic Pitch Post-Processing)
- Default post-processing settings used:
  - onset_threshold=`0.5`
  - frame_threshold=`0.3`
  - minimum_note_length_ms=`127.7`
- TF extracted notes: `95`
- CoreML extracted notes: `99`
- Same detected-note set within tolerance: `NO`
- Matching tolerance: onset `±0.050s`, duration `±0.150s`
- Matched notes: `84`
- Notes only in TF: `11`
- Notes only in CoreML: `15`

### TF Extracted Notes
| Pitch | Start (s) | Duration (s) | Amplitude |
| --- | ---: | ---: | ---: |
| E4 (64) | 1.533 | 0.174 | 0.299 |
| E3 (52) | 1.556 | 0.582 | 0.640 |
| A2 (45) | 1.579 | 0.721 | 0.629 |
| A3 (57) | 1.579 | 0.302 | 0.457 |
| A3 (57) | 1.881 | 0.233 | 0.483 |
| C4 (60) | 1.881 | 0.199 | 0.439 |
| E4 (64) | 1.881 | 0.361 | 0.377 |
| D3 (50) | 2.114 | 0.163 | 0.442 |
| A3 (57) | 2.114 | 0.151 | 0.474 |
| G3 (55) | 2.138 | 0.255 | 0.488 |
| E3 (52) | 2.393 | 0.546 | 0.553 |
| G3 (55) | 2.393 | 0.337 | 0.428 |
| E4 (64) | 2.405 | 0.395 | 0.362 |
| C3 (48) | 2.416 | 0.244 | 0.713 |
| C4 (60) | 2.428 | 0.186 | 0.458 |
| C4 (60) | 2.648 | 0.174 | 0.284 |
| C3 (48) | 2.660 | 0.244 | 0.691 |
| C3 (48) | 2.904 | 0.267 | 0.594 |
| C4 (60) | 2.904 | 0.360 | 0.412 |
| E4 (64) | 2.904 | 0.221 | 0.369 |
| E3 (52) | 2.939 | 0.221 | 0.516 |
| G3 (55) | 2.939 | 0.313 | 0.537 |
| D3 (50) | 3.194 | 0.174 | 0.485 |
| F2 (41) | 3.240 | 0.418 | 0.452 |
| F3 (53) | 3.438 | 0.406 | 0.373 |
| C3 (48) | 3.542 | 0.174 | 0.686 |
| C3 (48) | 3.716 | 0.221 | 0.640 |
| A3 (57) | 3.751 | 0.197 | 0.258 |
| C3 (48) | 3.937 | 0.222 | 0.446 |
| C4 (60) | 3.937 | 0.268 | 0.536 |
| E4 (64) | 3.937 | 0.233 | 0.395 |
| A3 (57) | 3.960 | 0.233 | 0.529 |
| F3 (53) | 3.972 | 0.199 | 0.450 |
| C4 (60) | 4.205 | 0.813 | 0.515 |
| A3 (57) | 4.449 | 0.174 | 0.362 |
| E3 (52) | 4.461 | 0.882 | 0.562 |
| E4 (64) | 4.461 | 0.430 | 0.402 |
| A2 (45) | 4.507 | 0.755 | 0.632 |
| E4 (64) | 5.006 | 0.267 | 0.447 |
| C4 (60) | 5.018 | 0.522 | 0.424 |
| A2 (45) | 5.262 | 0.557 | 0.574 |
| E4 (64) | 5.273 | 0.174 | 0.429 |
| E3 (52) | 5.343 | 0.476 | 0.581 |
| E4 (64) | 5.448 | 0.325 | 0.428 |
| C4 (60) | 5.541 | 0.501 | 0.404 |
| A2 (45) | 5.819 | 0.501 | 0.541 |
| E3 (52) | 5.819 | 0.454 | 0.584 |
| C4 (60) | 6.041 | 0.406 | 0.473 |
| A2 (45) | 6.320 | 0.209 | 0.539 |
| A3 (57) | 6.320 | 0.151 | 0.403 |
| D3 (50) | 6.331 | 0.186 | 0.525 |
| C3 (48) | 6.587 | 0.755 | 0.633 |
| C4 (60) | 6.587 | 0.511 | 0.339 |
| E3 (52) | 6.598 | 0.743 | 0.608 |
| G3 (55) | 6.598 | 0.499 | 0.613 |
| G3 (55) | 7.098 | 0.255 | 0.412 |
| C4 (60) | 7.098 | 0.244 | 0.583 |
| C3 (48) | 7.341 | 0.267 | 0.651 |
| G3 (55) | 7.353 | 0.174 | 0.478 |
| C3 (48) | 7.608 | 0.267 | 0.600 |
| C4 (60) | 7.608 | 0.163 | 0.298 |
| F2 (41) | 7.632 | 0.186 | 0.486 |
| F3 (53) | 7.864 | 0.233 | 0.469 |
| C3 (48) | 7.875 | 0.257 | 0.564 |
| A3 (57) | 7.922 | 0.175 | 0.496 |
| C4 (60) | 8.086 | 0.186 | 0.364 |
| F3 (53) | 8.097 | 0.221 | 0.563 |
| A3 (57) | 8.097 | 0.209 | 0.561 |
| C3 (48) | 8.132 | 0.186 | 0.524 |
| C4 (60) | 8.353 | 0.221 | 0.474 |
| D3 (50) | 8.364 | 0.197 | 0.570 |
| G3 (55) | 8.364 | 0.209 | 0.614 |
| A3 (57) | 8.608 | 0.186 | 0.430 |
| E3 (52) | 8.631 | 0.499 | 0.581 |
| A2 (45) | 8.655 | 0.488 | 0.637 |
| E4 (64) | 8.898 | 0.221 | 0.433 |
| C4 (60) | 8.945 | 0.186 | 0.518 |
| E3 (52) | 9.131 | 0.209 | 0.433 |
| C4 (60) | 9.131 | 0.255 | 0.581 |
| E4 (64) | 9.131 | 0.221 | 0.403 |
| A2 (45) | 9.142 | 0.255 | 0.513 |
| A2 (45) | 9.398 | 0.209 | 0.539 |
| G3 (55) | 9.409 | 0.232 | 0.571 |
| D3 (50) | 9.444 | 0.139 | 0.493 |
| E3 (52) | 9.641 | 3.613 | 0.701 |
| G#3 (56) | 9.641 | 3.462 | 0.581 |
| B3 (59) | 9.641 | 0.221 | 0.365 |
| E4 (64) | 9.653 | 0.197 | 0.292 |
| B2 (47) | 9.734 | 1.754 | 0.641 |
| B4 (71) | 10.281 | 0.267 | 0.329 |
| B3 (59) | 10.386 | 1.242 | 0.366 |
| E4 (64) | 10.606 | 0.174 | 0.435 |
| B4 (71) | 11.419 | 0.418 | 0.335 |
| B2 (47) | 11.489 | 1.662 | 0.595 |
| B3 (59) | 12.221 | 0.522 | 0.331 |

### CoreML Extracted Notes
| Pitch | Start (s) | Duration (s) | Amplitude |
| --- | ---: | ---: | ---: |
| A2 (45) | 1.509 | 0.802 | 0.655 |
| E4 (64) | 1.533 | 0.197 | 0.322 |
| E3 (52) | 1.556 | 0.593 | 0.674 |
| A3 (57) | 1.579 | 0.313 | 0.521 |
| C4 (60) | 1.672 | 0.197 | 0.284 |
| C4 (60) | 1.881 | 0.199 | 0.475 |
| E4 (64) | 1.881 | 0.373 | 0.414 |
| A3 (57) | 1.892 | 0.222 | 0.547 |
| A3 (57) | 2.114 | 0.163 | 0.538 |
| D3 (50) | 2.138 | 0.151 | 0.511 |
| G3 (55) | 2.138 | 0.255 | 0.553 |
| E3 (52) | 2.393 | 0.546 | 0.593 |
| G3 (55) | 2.393 | 0.372 | 0.455 |
| E4 (64) | 2.405 | 0.406 | 0.408 |
| C3 (48) | 2.416 | 0.244 | 0.758 |
| C4 (60) | 2.428 | 0.197 | 0.498 |
| C4 (60) | 2.648 | 0.255 | 0.306 |
| C3 (48) | 2.660 | 0.244 | 0.731 |
| C3 (48) | 2.904 | 0.267 | 0.640 |
| C4 (60) | 2.904 | 0.372 | 0.464 |
| E4 (64) | 2.904 | 0.244 | 0.410 |
| G3 (55) | 2.927 | 0.348 | 0.568 |
| E3 (52) | 2.939 | 0.232 | 0.572 |
| D3 (50) | 3.194 | 0.174 | 0.548 |
| F2 (41) | 3.240 | 0.430 | 0.483 |
| C3 (48) | 3.438 | 0.279 | 0.761 |
| F3 (53) | 3.473 | 0.383 | 0.424 |
| C3 (48) | 3.716 | 0.221 | 0.693 |
| A3 (57) | 3.740 | 0.209 | 0.297 |
| C4 (60) | 3.763 | 0.174 | 0.265 |
| C3 (48) | 3.937 | 0.222 | 0.478 |
| E4 (64) | 3.937 | 0.233 | 0.432 |
| C4 (60) | 3.949 | 0.257 | 0.593 |
| A3 (57) | 3.960 | 0.245 | 0.573 |
| F3 (53) | 3.972 | 0.210 | 0.504 |
| C4 (60) | 4.205 | 0.813 | 0.567 |
| A2 (45) | 4.449 | 0.813 | 0.666 |
| A3 (57) | 4.449 | 0.302 | 0.389 |
| E3 (52) | 4.461 | 0.824 | 0.608 |
| E4 (64) | 4.461 | 0.546 | 0.405 |
| E4 (64) | 5.006 | 0.267 | 0.479 |
| C4 (60) | 5.018 | 0.522 | 0.456 |
| A2 (45) | 5.262 | 0.557 | 0.611 |
| E4 (64) | 5.273 | 0.174 | 0.467 |
| E3 (52) | 5.285 | 0.511 | 0.610 |
| E4 (64) | 5.448 | 0.337 | 0.460 |
| C4 (60) | 5.541 | 0.501 | 0.436 |
| E3 (52) | 5.796 | 0.489 | 0.614 |
| A2 (45) | 5.819 | 0.501 | 0.575 |
| A3 (57) | 6.041 | 0.279 | 0.287 |
| C4 (60) | 6.041 | 0.546 | 0.451 |
| A2 (45) | 6.320 | 0.209 | 0.578 |
| A3 (57) | 6.320 | 0.174 | 0.459 |
| D3 (50) | 6.331 | 0.197 | 0.562 |
| C3 (48) | 6.587 | 0.755 | 0.676 |
| C4 (60) | 6.587 | 0.511 | 0.383 |
| E3 (52) | 6.598 | 0.743 | 0.660 |
| G3 (55) | 6.598 | 0.755 | 0.591 |
| C4 (60) | 7.098 | 0.267 | 0.601 |
| C3 (48) | 7.341 | 0.267 | 0.695 |
| G3 (55) | 7.353 | 0.174 | 0.513 |
| C3 (48) | 7.608 | 0.267 | 0.632 |
| C4 (60) | 7.608 | 0.186 | 0.346 |
| F2 (41) | 7.632 | 0.338 | 0.407 |
| C3 (48) | 7.875 | 0.442 | 0.584 |
| F3 (53) | 7.887 | 0.210 | 0.542 |
| A3 (57) | 7.910 | 0.175 | 0.532 |
| A3 (57) | 8.086 | 0.232 | 0.605 |
| C4 (60) | 8.086 | 0.209 | 0.416 |
| F3 (53) | 8.097 | 0.232 | 0.605 |
| C4 (60) | 8.353 | 0.232 | 0.507 |
| D3 (50) | 8.364 | 0.197 | 0.630 |
| G3 (55) | 8.364 | 0.209 | 0.658 |
| E3 (52) | 8.631 | 0.499 | 0.628 |
| A3 (57) | 8.631 | 0.174 | 0.484 |
| A2 (45) | 8.655 | 0.488 | 0.674 |
| C4 (60) | 8.782 | 0.151 | 0.278 |
| E4 (64) | 8.852 | 0.267 | 0.448 |
| C4 (60) | 8.945 | 0.186 | 0.564 |
| E3 (52) | 9.131 | 0.209 | 0.463 |
| C4 (60) | 9.131 | 0.267 | 0.615 |
| E4 (64) | 9.131 | 0.232 | 0.433 |
| A2 (45) | 9.142 | 0.244 | 0.553 |
| A3 (57) | 9.142 | 0.244 | 0.337 |
| A2 (45) | 9.386 | 0.221 | 0.585 |
| A3 (57) | 9.386 | 0.163 | 0.461 |
| G3 (55) | 9.409 | 0.232 | 0.618 |
| D3 (50) | 9.444 | 0.151 | 0.531 |
| B2 (47) | 9.641 | 1.847 | 0.678 |
| E3 (52) | 9.641 | 3.660 | 0.747 |
| G#3 (56) | 9.641 | 3.497 | 0.612 |
| B3 (59) | 9.641 | 0.232 | 0.445 |
| E4 (64) | 9.653 | 0.338 | 0.324 |
| B3 (59) | 10.270 | 1.451 | 0.373 |
| B4 (71) | 10.281 | 0.279 | 0.330 |
| E4 (64) | 10.595 | 0.197 | 0.445 |
| B4 (71) | 11.407 | 0.418 | 0.339 |
| B2 (47) | 11.489 | 1.662 | 0.626 |
| B3 (59) | 12.175 | 0.522 | 0.328 |

### Notes Present In One Output But Not The Other
- Only in TF:
  - A2 (45), start=1.579s, duration=0.721s
  - C3 (48), start=3.542s, duration=0.174s
  - A2 (45), start=4.507s, duration=0.755s
  - E3 (52), start=5.343s, duration=0.476s
  - G3 (55), start=6.598s, duration=0.499s
  - G3 (55), start=7.098s, duration=0.255s
  - F2 (41), start=7.632s, duration=0.186s
  - C3 (48), start=7.875s, duration=0.257s
  - C3 (48), start=8.132s, duration=0.186s
  - B2 (47), start=9.734s, duration=1.754s
  - B3 (59), start=10.386s, duration=1.242s
- Only in CoreML:
  - A2 (45), start=1.509s, duration=0.802s
  - C4 (60), start=1.672s, duration=0.197s
  - C3 (48), start=3.438s, duration=0.279s
  - C4 (60), start=3.763s, duration=0.174s
  - A2 (45), start=4.449s, duration=0.813s
  - E3 (52), start=5.285s, duration=0.511s
  - A3 (57), start=6.041s, duration=0.279s
  - G3 (55), start=6.598s, duration=0.755s
  - F2 (41), start=7.632s, duration=0.338s
  - C3 (48), start=7.875s, duration=0.442s
  - C4 (60), start=8.782s, duration=0.151s
  - A3 (57), start=9.142s, duration=0.244s
  - A3 (57), start=9.386s, duration=0.163s
  - B2 (47), start=9.641s, duration=1.847s
  - B3 (59), start=10.270s, duration=1.451s

## Part C - CoreML Threshold Sensitivity (Onset Threshold Sweep)
- Sweep range: `0.20` to `0.60` in steps of `0.05`
- Frame threshold held at default: `0.3`
- Selection rule:
  - `min mismatch_count, then max F1, then closest threshold to 0.5`

| Threshold | CoreML Notes | Matched | TF-only | CoreML-only | Mismatch | Precision | Recall | F1 |
| ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: |
| 0.20 | 148 | 56 | 39 | 92 | 131 | 0.378 | 0.589 | 0.461 |
| 0.25 | 130 | 65 | 30 | 65 | 95 | 0.500 | 0.684 | 0.578 |
| 0.30 | 119 | 75 | 20 | 44 | 64 | 0.630 | 0.789 | 0.701 |
| 0.35 | 114 | 79 | 16 | 35 | 51 | 0.693 | 0.832 | 0.756 |
| 0.40 | 106 | 87 | 8 | 19 | 27 | 0.821 | 0.916 | 0.866 |
| 0.45 | 102 | 88 | 7 | 14 | 21 | 0.863 | 0.926 | 0.893 |
| 0.50 | 99 | 84 | 11 | 15 | 26 | 0.848 | 0.884 | 0.866 |
| 0.55 | 95 | 78 | 17 | 17 | 34 | 0.821 | 0.821 | 0.821 |
| 0.60 | 86 | 64 | 31 | 22 | 53 | 0.744 | 0.674 | 0.707 |

- Adjusted CoreML onset threshold candidate: `0.45`
- At that threshold: matched=`88`, mismatch=`21`, F1=`0.893`
